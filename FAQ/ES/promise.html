<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å®ˆå¤œäººç¬”è®°</title>
    <meta name="description" content="å®ˆå¤œäººç¬”è®°">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.f09e5b7a.css" as="style"><link rel="preload" href="/assets/js/app.903983bb.js" as="script"><link rel="preload" href="/assets/js/2.c5c844f9.js" as="script"><link rel="preload" href="/assets/js/13.f84ff47d.js" as="script"><link rel="prefetch" href="/assets/js/10.acc61093.js"><link rel="prefetch" href="/assets/js/11.b5b7d313.js"><link rel="prefetch" href="/assets/js/12.044e77b3.js"><link rel="prefetch" href="/assets/js/14.4f25373e.js"><link rel="prefetch" href="/assets/js/15.69ad7253.js"><link rel="prefetch" href="/assets/js/16.ac264240.js"><link rel="prefetch" href="/assets/js/17.8684da05.js"><link rel="prefetch" href="/assets/js/18.ceef7e7d.js"><link rel="prefetch" href="/assets/js/19.fdccf963.js"><link rel="prefetch" href="/assets/js/20.eea2ef94.js"><link rel="prefetch" href="/assets/js/21.436a904b.js"><link rel="prefetch" href="/assets/js/22.5b0e4632.js"><link rel="prefetch" href="/assets/js/23.456132eb.js"><link rel="prefetch" href="/assets/js/24.0c9dfbdb.js"><link rel="prefetch" href="/assets/js/25.1e46f166.js"><link rel="prefetch" href="/assets/js/26.bc6d72fe.js"><link rel="prefetch" href="/assets/js/27.699fbdd0.js"><link rel="prefetch" href="/assets/js/28.b4423e59.js"><link rel="prefetch" href="/assets/js/3.b94df1a7.js"><link rel="prefetch" href="/assets/js/4.29bcc168.js"><link rel="prefetch" href="/assets/js/5.a332531e.js"><link rel="prefetch" href="/assets/js/6.a34f260f.js"><link rel="prefetch" href="/assets/js/7.b152462c.js"><link rel="prefetch" href="/assets/js/8.6811b85d.js"><link rel="prefetch" href="/assets/js/9.a9a41e29.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f09e5b7a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">å®ˆå¤œäººç¬”è®°</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link router-link-active">
  æ±‚ç´¢
</a></div><div class="nav-item"><a href="/Thought/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/StackFei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubé¦–é¡µ
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link router-link-active">
  æ±‚ç´¢
</a></div><div class="nav-item"><a href="/Thought/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/StackFei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHubé¦–é¡µ
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/FAQ/" class="sidebar-link">ğŸ“šJSæ‰‹æ®‹</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>èŠ±é‡Œèƒ¡å“¨å¿…å¤‡ç‚¹</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/ES/promise.html" class="active sidebar-link">ğŸš—promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FAQ/ES/promise.html#åŸºæœ¬çš„åœºæ™¯" class="sidebar-link">åŸºæœ¬çš„åœºæ™¯</a></li><li class="sidebar-sub-header"><a href="/FAQ/ES/promise.html#åŠŸèƒ½é¡¹" class="sidebar-link">åŠŸèƒ½é¡¹</a></li><li class="sidebar-sub-header"><a href="/FAQ/ES/promise.html#ä¼˜åŒ–é¡¹" class="sidebar-link">ä¼˜åŒ–é¡¹</a></li><li class="sidebar-sub-header"><a href="/FAQ/ES/promise.html#è¡¥å……é¡¹" class="sidebar-link">è¡¥å……é¡¹</a></li><li class="sidebar-sub-header"><a href="/FAQ/ES/promise.html#æµ‹è¯•é¡¹" class="sidebar-link">æµ‹è¯•é¡¹</a></li></ul></li><li><a href="/FAQ/ES/react-window.html" class="sidebar-link">ğŸš•é•¿åˆ—è¡¨</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Reactä¸­çš„ä¸€äº›å°å¿ƒå¾—</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/React/VirtualDom.html" class="sidebar-link">ğŸŒ°ç®€å•çš„è™šæ‹ŸDom</a></li><li><a href="/FAQ/React/react-router.html" class="sidebar-link">ğŸ‘router</a></li><li><a href="/FAQ/React/context.html" class="sidebar-link">ğŸ‡ä¸Šä¸‹æ–‡</a></li><li><a href="/FAQ/React/react-redux.html" class="sidebar-link">ğŸreduxçš„é€šè®¯æ–¹å¼</a></li><li><a href="/FAQ/React/react-redux-middleware.html" class="sidebar-link">ğŸç®€æ˜“ä¸­é—´ä»¶</a></li><li><a href="/FAQ/React/Hooks.html" class="sidebar-link">ğŸŠHooks</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vueçš„ä¸€äº›å°ç¬”è®°</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/Vue/Cli.html" class="sidebar-link">ğŸ”¨èŠ±é‡Œèƒ¡å“¨çš„cli</a></li><li><a href="/FAQ/Vue/observer.html" class="sidebar-link">ğŸ”§ä¹ä¸ç‰ˆæœ¬MvvM</a></li><li><a href="/FAQ/Vue/Communication.html" class="sidebar-link">ğŸ› ï¸è®°ä¸€æ¬¡é€šä¿¡æ–¹å¼</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ—¥å¸¸æ‚ç©</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/Work/TSC.html" class="sidebar-link">ğŸ‹ï¸â€â™‚ï¸TypeScript</a></li><li><a href="/FAQ/Work/cicd.html" class="sidebar-link">ğŸš´æŒç»­é›†æˆéƒ¨ç½²ï¼ˆci/cdï¼‰</a></li><li><a href="/FAQ/Work/AOP.html" class="sidebar-link">ğŸŒï¸â€â™‚ï¸AOPé¢å‘åˆ‡ç‰‡ç¼–ç¨‹</a></li><li><a href="/FAQ/Work/WeChat.html" class="sidebar-link">â›¹ï¸è¸©å‘Reactç³»åˆ—å°ç¨‹åº</a></li><li><a href="/FAQ/Work/Work1.html" class="sidebar-link">ğŸ¤¾â€â™‚ï¸å‰ç«¯è¯·æ±‚çš„æ­£ç¡®æ‰“å¼€æ–¹å¼</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ä¹±å†™ç³»åˆ—</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/Node/require.html" class="sidebar-link">ğŸ€requireåŸºæ“</a></li><li><a href="/FAQ/Node/Koa.html" class="sidebar-link">âš½ï¸åˆçº§Koa</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>åæ–¹é«˜èƒ½, æ³¨æ„! è¿™é‡Œä¸æ•™ä½ æ€ä¹ˆç”¨<code>Promise</code>, æ˜¯æ•™ä½ æ€ä¹ˆå†™å±äºè‡ªå·±çš„<code>Promise</code></p></blockquote> <h2 id="åŸºæœ¬çš„åœºæ™¯"><a href="#åŸºæœ¬çš„åœºæ™¯" class="header-anchor">#</a> åŸºæœ¬çš„åœºæ™¯</h2> <p>å¹³å¸¸ç”¨åˆ°<code>Promise</code>çš„æ—¶å€™ä¼šè§‰å¾—å¾ˆæ–¹ä¾¿, å…·ä½“æ€ä¹ˆå½¢å®¹å¤§å¯å»çœ‹å®˜æ–¹çš„è¯´è¾, è¿™é‡Œå°±ä»¥æœ€åŸºæœ¬çš„ä½¿ç”¨ä¸ºåˆ‡å…¥ç‚¹æ¥å…¥æ‰‹. ä»¥ä¸‹çš„ç‚¹, ä»¥åŠä¸€ä¸‹æ¯ä¸€æ­¥çš„æ“ä½œéƒ½æ˜¯ä¸¥æ ¼æŒ‰ç…§<a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer"><code>PromiseA+</code>è§„èŒƒ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>æ¥æ“ä½œçš„</p> <ul><li>ç±» (æˆ–è€…çº¯å‡½æ•° - æ³¨æ„thisçš„æŒ‡å‘é—®é¢˜)</li> <li>å®ä¾‹æ–¹æ³•/é™æ€æ–¹æ³•/åŸå…ˆæ–¹æ³• ()</li> <li>æ‰©å±•æ€§ (å…¼å®¹æ€§)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">execution</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
		<span class="token punctuation">}</span>
		<span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
		<span class="token punctuation">}</span>
		<span class="token function">execution</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æœ€åŸºæœ¬çš„åŠŸèƒ½ç›®å‰æ˜¯å¯ä»¥ä½¿ç”¨äº†, å¯ä»¥å®ä¾‹åŒ–, å¯ä»¥ä¼ å‚, ç”±äº<code>Promise</code>æ˜¯ç«‹å³æ‰§è¡Œå‡½æ•°,æ‰€ä»¥è¿™é‡Œç›´æ¥æ‰§è¡Œ, ä¸‹é¢å†æ¥ä¸€æ­¥ä¸€æ­¥çš„æ™šä¸ŠåŠŸèƒ½.</p> <h2 id="åŠŸèƒ½é¡¹"><a href="#åŠŸèƒ½é¡¹" class="header-anchor">#</a> åŠŸèƒ½é¡¹</h2> <p>Well known <code>Promise</code> ä¸­ å¯ä»¥ä¼ å…¥æˆåŠŸå’Œå¤±è´¥çš„å‡½æ•°, æ ¹æ®æˆåŠŸå’Œå¤±è´¥çš„æ–¹æ³•æ¥åšä¸‹ä¸€æ­¥æ“ä½œ, æœ€é‡è¦çš„ä¸€ç‚¹, éœ€è¦æœ‰ä¸€ä¸ªçŠ¶æ€å€¼æ¥åˆ¤æ–­, æˆåŠŸäº†å°±ä¸èƒ½å¤±è´¥, åä¹‹äº¦ç„¶, å…¶ä½™çš„çŠ¶æ€ç»Ÿç§°ä¸ºç­‰å¾…çŠ¶æ€.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;PENDING&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;FULFILLED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;REJECTED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reject <span class="token operator">=</span> <span class="token operator">...</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>çœ‹èµ·æ¥è¿˜ä¸é”™, æ¥ä¸‹æ¥éš¾åº¦ç¨å¾®å‡çº§, éƒ½çŸ¥é“<code>new Promise</code> åé¢å¯ä»¥ç›´æ¥è·Ÿä¸Š<code>then</code>æ–¹æ³•, ä»–ä¹Ÿæ¥æ”¶ä¸¤ä¸ªå‚æ•° æˆåŠŸ/å¤±è´¥(<code>onFulfilled, onRejected</code>)çš„çŠ¶æ€, ä¾æ®ä¸åŒçš„çŠ¶æ€æ‰§è¡Œä¸åŒçš„æ–¹æ³•, æ˜¾è€Œæ˜“è§ä»–æ˜¯å®ä¾‹ä¸Šçš„æ–¹æ³•, å…ˆå†™å‡ºæ¥çœ‹çœ‹.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token operator">...</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token operator">...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸€åˆ‡çœ‹èµ·æ¥ä¼¼ä¹éƒ½æ˜¯é‚£ä¹ˆå®Œç¾, æˆ‘ä»¬å†æŠŠéš¾åº¦æé«˜ä¸€ç‚¹, å¦‚æœæˆ‘åœ¨<code>Promise</code>ä¸­è¿”å›ä¸€ä¸ª<code>setTimeout</code>æˆ–è€…å…¶ä»–ä»»æ„ä¸€ä¸ªå¼‚æ­¥æ“ä½œ, è¯´åˆ°è¿™å¤§å®¶åº”è¯¥éƒ½æ‡‚äº†å§, åŒæ­¥å¼‚æ­¥çš„é—®é¢˜å°±ä¸ç”¨æˆ‘å¤šè¯´äº†å§, è¿˜æ²¡ç­‰æˆ‘æ‰§è¡Œ, <code>Promise</code>å·²ç»è·‘å®Œäº†, æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨åˆšåˆšçš„<code>then</code>ä¸­çš„<code>PENDING</code>çŠ¶æ€ä¸­åšä¸€ç‚¹å¤„ç†, åœ¨<code>execution</code> ä¸­çš„ æˆåŠŸ/å¤±è´¥ (resolve,reject) ä¸­ä¹Ÿéœ€è¦åšç‚¹å¤„ç†, æ€è·¯ç®€å•, æ—¢ç„¶ç­‰å¾…, é‚£æˆ‘å°±æŠŠä½ <code>push</code>åˆ°ä¸€ä¸ªæ•°ç»„, å¼‚æ­¥å®Œäº† æˆ‘å†ä¾æ¬¡æ‰§è¡Œ,</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallBacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallBacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallBacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> value<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallBacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ„Ÿè§‰ç¦»æˆåŠŸåˆè¿‘äº†ä¸€æ­¥æœ‰æ²¡æœ‰, å†æ¥æ¢ä¸€ä¸ªçŸ¥è¯†ç‚¹, <code>jquery</code> é“¾å¼è°ƒç”¨ åº”è¯¥éƒ½ç”¨è¿‡å§, ä¸å¥½æ„æ€<code>then</code> ä¹‹åä¹Ÿå¯ä»¥ä½¿ç”¨<code>.</code> è¯­æ³•æ¥ç€è°ƒç”¨, ä¹‹æ‰€ä»¥èƒ½ä½¿ç”¨é“¾å¼è°ƒç”¨, ä»–çš„æ ¸å¿ƒè§‚å¿µ, å°±æ˜¯è¿”å›è‡ªå·±, è¿™æ ·æ‰èƒ½åœ¨è°ƒç”¨è‡ªå·±çš„æ–¹æ³•, é‚£å°±å¥½ç†è§£äº†, <code>then</code> ç›´æ¥è¿”å›ä¸€ä¸ª<code>Promise</code> ä¼¼ä¹æ˜¯å¯è¡Œçš„,</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¥½äº†ï¼Œ å„ä½èŒæ–° æ˜¯ä¸æ˜¯ä»¥ä¸ºåˆ°æ­¤å°±ç»“æŸäº†, å‘µ ï¼å¹´è½»äºº, å°è¯•ä¸€ä¸‹å›è°ƒåœ°ç‹±çš„ææ€–,(ä½ ä»¥ä¸ºä½¿ç”¨<code>Promise</code>å°±ç¢°ä¸åˆ°äº†ä¹ˆ, å¹´è½»äºº, ä½ æ°¸è¿œä¸çŸ¥é“ä½ çš„ç”¨æˆ·ä¼šæ€ä¹ˆä½¿ç”¨ä½ å†™çš„ä¸œè¥¿), æœ‰é‚£ä¹ˆä¸€å¤©ä½ çš„ç”¨æˆ·åœ¨ <code>Promise</code>è¿”å›å€¼ä¸­åœ¨ä½¿ç”¨<code>Promise</code> ç„¶åä½ å†™çš„ä»£ç å°±ç‚¸äº†. è¿™ç§åµŒå¥—ç±»å‹çš„æœ€ç®€å•çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨é€’å½’æ¥å¤„ç†. é‚£å°±æœ‰éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥åˆ¤æ–­äº†.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token operator">...</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">resolvePromise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å·®ç‚¹å¿˜äº†, è¿™é‡Œç›´æ¥å°†<code>promise</code> è¿™ä¸ªå®ä¾‹åœ¨<code>resolvePromise</code>ä¸­ä½¿ç”¨æ˜¯å¦å¯ä»¥ ? å“ˆå“ˆå“ˆ, æˆ‘è¿˜æ˜¯åŠ ä¸Šä¸€ä¸ªå¼‚æ­¥çš„å®šæ—¶å™¨æ¥ç®€å•å¤„ç†ä¸€ä¸‹, åªéœ€è¦å°†<code>push</code>çš„å‡½æ•°ä¸¢åˆ°<code>setTimeout</code>ä¸­æ—¢å¯, è‡³äºåŸå› , é‚£ä½ å¾—å¥½å¥½äº†è§£ä¸€ä¸‹äº‹ä»¶ç¯. è¿™é‡Œçš„é‡ç‚¹è¿˜æ˜¯åˆ¤æ–­<code>x</code>çš„ç±»å‹. å®˜æ–¹æ˜¯è¿™ä¹ˆè§£é‡Šçš„ æœ‰ä¸¤å¤§ç‚¹ <a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer"><code>e and x refer to the same object, reject promise with a TypeError as the reason.</code>,<code>if x is an object or function</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, è€ƒéªŒæ•°æ®ç±»å‹åŸºæœ¬åŠŸçš„æ—¶å€™åˆ°äº†</p> <ul><li>ä¸èƒ½è‡ªå·±è¿”å›è‡ªå·± (è‡ªå·±ç­‰å¾…è‡ªå·±çš„æ‰§è¡Œ)</li> <li>ç±»å‹å¯ä»¥æ˜¯<code>object</code>,<code>function</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>	<span class="token keyword">const</span> <span class="token function-variable function">resolvePromise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		 <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;event noop Promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token operator">...</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><p>å”‰ï¼ æ¶å­ç®—æ˜¯æ­å‡ºæ¥äº†, ä¸‹é¢æ¥ä¸€æ­¥æ­¥å®Œå–„, å¯ä»¥è¯´è¿™ä¸ªå‡½æ•°æ‰æ˜¯<code>Promise</code>çš„æ ¸å¿ƒç‚¹, èµ°åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå¯ä»¥æ–­å®šæ˜¯ä¸ªæ­£å¸¸çš„ å‡½æ•°æˆ–è€…å¯¹è±¡ç±»å‹, å¦‚æœæ˜¯<code>Promise</code> åªéœ€è¦éªŒè¯ä»–çš„<code>then</code>æ–¹æ³•å±æ€§æ—¢å¯, å¹¶ä¸”è€ƒè™‘åˆ°å„å¤§æ¶å¿ƒçš„å…¼å®¹æ€§, ä¹Ÿè¦ä¿è¯ <code>then</code>çš„æŒ‡å‘é—®é¢˜, æ¯•ç«Ÿæ•°æ®åŠ«æŒåŠ å±æ€§çš„æ–¹æ³•ä¹Ÿä¸æ˜¯å¾ˆå°‘æä¸€å˜´<code>defineProperty</code>, ç½ªé­ç¥¸é¦–,</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>then<span class="token punctuation">,</span><span class="token punctuation">{</span>
	<span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>é¿å…å…¶ä»–äººçš„æ–¹æ³•æ±¡æŸ“åˆ°è‡ªå·±å†™çš„, æœ‰å¿…è¦åšå…¼å®¹</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> then <span class="token operator">=</span> x<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
		x<span class="token punctuation">,</span>
		<span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">resolve</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>çœ‹èµ·æ¥æ˜¯çœŸçš„ç®€å•, ç„¶è€Œ, ä½ ä»¥ä¸ºå°±è¿™ä¹ˆç»“æŸäº†? å‘µ, å¹´è½»äºº, æˆ‘è¯´çš„ä¸æ˜¯ <code>then.call()</code>å®Œ ä¹‹åè¿”å›çš„è¿˜æ˜¯<code>Promise</code>è¿™ä¹ˆç®€å•, çš„ç¡®ï¼Œ è¿™é‡Œè¿˜å¾—åŠ ä¸€ä¸ªé€’å½’åˆ¤æ–­.</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æˆ‘è¯´çš„ä¸æ˜¯è¿™ä¸ª, æœ‰é‚£ä¹ˆä¸€å¤©, ä½ äº²çˆ±çš„ç”¨æˆ·, è¿™ä¹ˆæ¥ä½¿ç”¨ä½ å†™çš„<code>Promise</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>ç„¶åä½ å†™çš„ä»£ç , ä»–åˆå´©äº†, ä¹Ÿä¸èƒ½è¯´æ˜¯è¹¦, åªä¸è¿‡è¿”å›çš„ä¸œè¥¿ç¨å¾®æœ‰é‚£ä¹ˆä¸€ä¸¢ä¸¢çš„ä¸åŒ, å¹¸äºç•™äº†ä¸€æ‰‹, åœ¨åˆ°<code>then</code>çš„æ—¶å€™å°±åˆ¤æ–­ä¸€ä¸‹ä¼ å…¥çš„ç±»å‹æ—¢å¯</p> <div class="language-js extra-class"><pre class="language-js"><code>	onFulfilled <span class="token operator">=</span>
		<span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">;</span>
	onRejected <span class="token operator">=</span>
		<span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span>
			<span class="token operator">?</span> <span class="token function-variable function">onRejected</span>
			<span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					<span class="token keyword">throw</span> err<span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æ­£å¸¸å‡½æ•°, ok æ¥ä¸‹å»æ‰§è¡Œ, ä¸æ˜¯çš„è¯ é‚£å°±æ›´å¥½å¤„ç†, ç›´æ¥è¿”å›å³å¯, æŠ¥é”™é‚£å°±æ›´å¥½å¤„ç†äº†, throw å‘—  ä¸‡èƒ½çš„. åŸºæœ¬ä¸Šåˆ°æ­¤ä¸ºæ­¢, å†™çš„ç®—æ˜¯å·®ä¸å¤šäº†, å‰©ä¸‹çš„å°±æ˜¯ä¼˜åŒ–é¡¹äº†.</p> <h2 id="ä¼˜åŒ–é¡¹"><a href="#ä¼˜åŒ–é¡¹" class="header-anchor">#</a> ä¼˜åŒ–é¡¹</h2> <ul><li>æ—¢ç„¶æ˜¯å¤„ç†ç»™åˆ«äººç”¨çš„åº“, é‚£æŠ¥é”™æé†’æ˜¯å¿…ä¸å¯å°‘çš„, å°¤å…¶æ˜¯å–å€¼ä»¥åŠæ‰§è¡Œæ“ä½œ, è¿™äº›éƒ½æ˜¯æ­»çš„å†™æ³•, æ²¡å°‘å¥½è¯´çš„, ä¸¾ä¸ªä¾‹å­,</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//æ‰§è¡Œæ—¶</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token function">execution</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// å–å€¼æ—¶</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><ul><li>æ—¢ç„¶æåˆ°äº†å…¼å®¹, é‚£åˆå›åˆ°äº†åˆ¤æ–­<code>Promise</code>çš„è¯é¢˜ä¸Š, è¿˜æ˜¯é‚£å¥è¯, å°±æ€•åˆ«äººå†™çš„å’Œè‡ªå·±å†™çš„å†²çª, å½“ç„¶æˆ‘å†™çš„å¯ä¸ä¼šå†²çª, æ¯•ç«Ÿå¯æ˜¯æŒ‰ç…§è§„èŒƒæ¥å†™çš„, ä¹Ÿè¦åšä¸€ä¸‹å…¼å®¹, æ¯æ¬¡éƒ½é”å®šä¸€ä¸‹å€¼, ä¸‹æ¬¡ç¢°åˆ°ç›´æ¥ç»•è¿‡, è¯´åˆ°åº•è¿˜æ˜¯æ€•<code>Object.defineProperty</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> called<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> then <span class="token operator">=</span> x<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
			x<span class="token punctuation">,</span>
			<span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
				called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
				called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>è¿˜æœ‰ä¸€ç‚¹æ˜¯æœ€éªšçš„, æœ‰äº›ç”¨æˆ·å°±æ˜¯ä¸èµ°å¹³å¸¸è·¯<code>resolve</code>æ¥ç€è¿”å›<code>Promise</code>,ä½ è¯´ä½ èƒ½æ‹¿ä»–æ€ä¹ˆåŠ, å…¼å®¹å‘—ï¼Œ è¿™ä¸ªå€’ä¸æ˜¯å¾ˆéš¾, ç¹é‡ä½ éƒ½æ˜¯åŒä¸€ä¸ª<code>Promise</code>ï¼Œ é‚£å°±åˆ¤æ–­ä¸€ä¸‹å®ä¾‹å°±å¥½, å½“ç„¶<code>reject</code>æ˜¯å¯ä»¥ä¸ç†ä¼šçš„, åæ­£æ˜¯ä¸æ‰§è¡Œçš„, æ— æ‰€è°“!</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallBacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="è¡¥å……é¡¹"><a href="#è¡¥å……é¡¹" class="header-anchor">#</a> è¡¥å……é¡¹</h2> <p>éƒ½å†™åˆ°è¿™äº†,å°±é™„èµ å‡ ä¸ªå‘¨è¾¹å‡½æ•°<code>all</code>, <code>catch</code>,  <code>resolve</code> , <code>reject</code>ä¹‹ç±»çš„é™æ€æ–¹æ³• ä»¥åŠå…¨éƒ¨ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;PENDING&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;FULFILLED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;REJECTED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">execution</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">PENDING</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallBacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallBacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallBacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallBacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">execution</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    onFulfilled <span class="token operator">=</span>
      <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">;</span>
    onRejected <span class="token operator">=</span>
      <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span>
        <span class="token operator">?</span> <span class="token function-variable function">onRejected</span>
        <span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">resolvePromise</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;event noop Promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> called<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> then <span class="token operator">=</span> x<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
          x<span class="token punctuation">,</span>
          <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function-variable function">all</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> promise <span class="token operator">=</span> promises<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">processDate</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">processDate</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">processDate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> promise</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> promise<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token operator">++</span> <span class="token operator">===</span> promise<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">isPromise</span> <span class="token operator">=</span> <span class="token parameter">promise</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token keyword">typeof</span> promise <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> promise <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token keyword">typeof</span> promise <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">typeof</span> promise<span class="token punctuation">.</span>then <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
</code></pre></div><h2 id="æµ‹è¯•é¡¹"><a href="#æµ‹è¯•é¡¹" class="header-anchor">#</a> æµ‹è¯•é¡¹</h2> <p>æµ‹è¯•æ˜¯å¿…ç„¶çš„, åˆ«å†™äº†å¤§åŠå¤©ï¼Œ è·‘ä¸è¿‡æµ‹è¯•, é‚£è°æ•¢ç”¨ä½ å†™çš„ä¸œè¥¿,</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function-variable function">deferred</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> dfd <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  dfd<span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    dfd<span class="token punctuation">.</span>resolve <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
    dfd<span class="token punctuation">.</span>reject <span class="token operator">=</span> reject<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> dfd<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æ·»åŠ è¿™ä¸ªå€’ä½ çš„æ–‡ä»¶å°±è¡Œ, åˆ«é—®, å®˜æ–¹è®©è¿™ä¹ˆå¹²çš„, ç„¶åå†è£…ä¸€ä¸ªæµ‹è¯•åŒ…<code>promises-aplus-tests</code> ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ åŠ ä¸Šä½ çš„æ–‡ä»¶åæ—¢å¯.
è‡³æ­¤, å±äºè‡ªå·±çš„ä¹ä¸ç‰ˆ<code>Promise</code>å®Œæˆ.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°æ—¶é—´:</span> <span class="time">1/3/2020, 6:28:17 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/FAQ/" class="prev router-link-active">
        ğŸ“šJSæ‰‹æ®‹
      </a></span> <span class="next"><a href="/FAQ/ES/react-window.html">
        ğŸš•é•¿åˆ—è¡¨
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.903983bb.js" defer></script><script src="/assets/js/2.c5c844f9.js" defer></script><script src="/assets/js/13.f84ff47d.js" defer></script>
  </body>
</html>
