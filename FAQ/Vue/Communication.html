<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常见通信方式 | 守夜人笔记</title>
    <meta name="description" content="守夜人笔记">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.f09e5b7a.css" as="style"><link rel="preload" href="/assets/js/app.903983bb.js" as="script"><link rel="preload" href="/assets/js/2.c5c844f9.js" as="script"><link rel="preload" href="/assets/js/21.436a904b.js" as="script"><link rel="preload" href="/assets/js/10.acc61093.js" as="script"><link rel="prefetch" href="/assets/js/11.b5b7d313.js"><link rel="prefetch" href="/assets/js/12.044e77b3.js"><link rel="prefetch" href="/assets/js/13.f84ff47d.js"><link rel="prefetch" href="/assets/js/14.4f25373e.js"><link rel="prefetch" href="/assets/js/15.69ad7253.js"><link rel="prefetch" href="/assets/js/16.ac264240.js"><link rel="prefetch" href="/assets/js/17.8684da05.js"><link rel="prefetch" href="/assets/js/18.ceef7e7d.js"><link rel="prefetch" href="/assets/js/19.fdccf963.js"><link rel="prefetch" href="/assets/js/20.eea2ef94.js"><link rel="prefetch" href="/assets/js/22.5b0e4632.js"><link rel="prefetch" href="/assets/js/23.456132eb.js"><link rel="prefetch" href="/assets/js/24.0c9dfbdb.js"><link rel="prefetch" href="/assets/js/25.1e46f166.js"><link rel="prefetch" href="/assets/js/26.bc6d72fe.js"><link rel="prefetch" href="/assets/js/27.699fbdd0.js"><link rel="prefetch" href="/assets/js/28.b4423e59.js"><link rel="prefetch" href="/assets/js/3.b94df1a7.js"><link rel="prefetch" href="/assets/js/4.29bcc168.js"><link rel="prefetch" href="/assets/js/5.a332531e.js"><link rel="prefetch" href="/assets/js/6.a34f260f.js"><link rel="prefetch" href="/assets/js/7.b152462c.js"><link rel="prefetch" href="/assets/js/8.6811b85d.js"><link rel="prefetch" href="/assets/js/9.a9a41e29.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f09e5b7a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">守夜人笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link router-link-active">
  求索
</a></div><div class="nav-item"><a href="/Thought/" class="nav-link">
  随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/StackFei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub首页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link router-link-active">
  求索
</a></div><div class="nav-item"><a href="/Thought/" class="nav-link">
  随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/StackFei" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub首页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/FAQ/" class="sidebar-link">📚JS手残</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>花里胡哨必备点</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/ES/promise.html" class="sidebar-link">🚗promise</a></li><li><a href="/FAQ/ES/react-window.html" class="sidebar-link">🚕长列表</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React中的一些小心得</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/React/VirtualDom.html" class="sidebar-link">🌰简单的虚拟Dom</a></li><li><a href="/FAQ/React/react-router.html" class="sidebar-link">🍑router</a></li><li><a href="/FAQ/React/context.html" class="sidebar-link">🍇上下文</a></li><li><a href="/FAQ/React/react-redux.html" class="sidebar-link">🍎redux的通讯方式</a></li><li><a href="/FAQ/React/react-redux-middleware.html" class="sidebar-link">🍍简易中间件</a></li><li><a href="/FAQ/React/Hooks.html" class="sidebar-link">🍊Hooks</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue的一些小笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/Vue/Cli.html" class="sidebar-link">🔨花里胡哨的cli</a></li><li><a href="/FAQ/Vue/observer.html" class="sidebar-link">🔧乞丐版本MvvM</a></li><li><a href="/FAQ/Vue/Communication.html" class="active sidebar-link">🛠️记一次通信方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FAQ/Vue/Communication.html#前置知识" class="sidebar-link">前置知识</a></li><li class="sidebar-sub-header"><a href="/FAQ/Vue/Communication.html#常见操作" class="sidebar-link">常见操作</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>日常杂玩</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/Work/TSC.html" class="sidebar-link">🏋️‍♂️TypeScript</a></li><li><a href="/FAQ/Work/cicd.html" class="sidebar-link">🚴持续集成部署（ci/cd）</a></li><li><a href="/FAQ/Work/AOP.html" class="sidebar-link">🏌️‍♂️AOP面向切片编程</a></li><li><a href="/FAQ/Work/WeChat.html" class="sidebar-link">⛹️踩坑React系列小程序</a></li><li><a href="/FAQ/Work/Work1.html" class="sidebar-link">🤾‍♂️前端请求的正确打开方式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>乱写系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FAQ/Node/require.html" class="sidebar-link">🏀require基操</a></li><li><a href="/FAQ/Node/Koa.html" class="sidebar-link">⚽️初级Koa</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>又到了日常学习框架组件通信的时候, 讲道理, 还记得曾经看<code>React</code>通信就觉得恶心, 因为事实上你根本用不到那么花里胡哨的方式, 一个状态管理就搞定. 现如今我看到<code>Vue</code>的组建通信的方式, 更是看白了头, 各种堆<code>Api</code>.</p></blockquote> <p><strong>老规矩, 个人学习记录, 不喜勿喷</strong></p> <h2 id="前置知识"><a href="#前置知识" class="header-anchor">#</a> 前置知识</h2> <p>看到这块地方, 相信你已经对大多数<code>api</code>以及有了解到, 学到这我算是发现, 怪不得<code>Vue</code>上手比<code>React</code>快, 就是各种<code>Api</code>往上怼, 不是说很熟练, 起码对单向数据流的概念是有认知的, 单向的不陌生吧, 和<code>React</code>的操作一个尿性, 就是各种向下传, 向上回传.</p> <h2 id="常见操作"><a href="#常见操作" class="header-anchor">#</a> 常见操作</h2> <p>以下就是几种实现写法上的异同.</p> <ul><li><strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>props emit</span></strong></li> <li><strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>update:xxx sync v-model</span></strong></li> <li><strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>$parent $children</span></strong></li> <li><strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>$attrs $listeners</span></strong></li> <li><strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>provider inject</span></strong></li> <li><strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>ref</span></strong></li> <li><strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>eventBus</span></strong></li></ul> <h3 id="常见小🌰"><a href="#常见小🌰" class="header-anchor">#</a> 常见小🌰</h3> <p>常见的祖孙三代传递数据的小🌰</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// Parent
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">:price</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>price<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    components<span class="token operator">:</span><span class="token punctuation">{</span>Child<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>price<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

// Child
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{price}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    props<span class="token operator">:</span><span class="token punctuation">{</span>
        price<span class="token operator">:</span><span class="token punctuation">{</span>
            type<span class="token operator">:</span>Number
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><strong>以上传值方式, 简单粗暴也没有什么大难度的操作, 下面我们来尝试基本的更改操作, 前置以及说过单向数据, 肯定相差无几.</strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>props emit</span></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>// Parent
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">:price</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>price<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@changePrice</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>changePrice<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    components<span class="token operator">:</span><span class="token punctuation">{</span>Child<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>price<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">changePrice</span><span class="token punctuation">(</span><span class="token parameter">newPrice</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> newPrice
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

// Child
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{price}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>addPrice<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>➕💰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">addPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'changePrice'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span><span class="token punctuation">{</span>
        price<span class="token operator">:</span><span class="token punctuation">{</span>
            type<span class="token operator">:</span>Number
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>将方法丢到子组件等同于<code>this.$on('changePrice','changePrice')</code>, 然后到子组件用<code>this.$emit('changePrice',value)</code>, 接收回传调用, 单向数据流都是这么恶心, 只能修改状态源才能出发下流状态更新, 这种方式写那么一两层传那么一两层或许你还觉得没啥, 现在我想给你多加两层传递, 你可能就想轮键盘, 好在人家就是<code>Api</code>多, 各种恶性的情况都考虑到了, 如下</p> <ul><li><strong>穿插几个小的case方法</strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>update:xxx sync v-model</span></li></ul> <p>讲道理, 这前面两个真的我就没见人用过, 但是你还必须得会, 你说气不气, 这里过渡一下就行了, 知道有这种方式就行.</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// Parent
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">:count</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">@update:</span>count</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>newValue =&gt; count = newValue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Child</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">:count.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Child</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
// Child
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">sonChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// parent 必须使用 :count.sync=&quot;count&quot;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;update:count&quot;</span><span class="token punctuation">,</span> <span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>其中这两种是等价式的操作, 由于第一种方式写的太过于臃肿, 于是乎官方给出了第二种的实现方式, 那我为什么还要学习第一种???, 还是要注意一点<code>update:</code>是固定写法, 重点来了, 我会告诉你, 还有更加简单的方法, <code>v-model</code>, 但是也有不小的局限性. 先来看看方法.</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Child</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>??? 挖槽, 突然回过神, 这个可以双向绑定, 太坑<code>React</code>系列了, 又一查, 好像只能接受单值, 不知道对象可以不.</p> <ul><li><strong>多层嵌套传参</strong><span class="badge warn" style="vertical-align:top;" data-v-26ebd6a3>$parent $children</span></li></ul> <p>其实常见的<code>$parent</code>,<code>$children</code>是足以解决我们的问题, 其实这是属于两种不同的操作, 但是实现的思路是差不多的, 以下是三层嵌套是使用的方法, 我们期望在第三层触发父组件的更新</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// Parent</span>
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">changePrice</span><span class="token punctuation">(</span><span class="token parameter">newPrice</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> newPrice
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Child</span>
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">addPrice</span><span class="token punctuation">(</span><span class="token parameter">newPrice</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'changePrice'</span><span class="token punctuation">,</span>newPrice<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ChildSon</span>
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">addPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'changePrice'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>OK, 效果显著, 由于其他代码都一样, 就不做全部展示, 看到这要是还看不懂那就没办法了, 三层貌似也是能接受的, 那我们来四层, 来五层, 来...层？？, 说到这又想轮键盘了, 你这不是闹着玩吗.</p> <ul><li><strong>多层嵌套传参升级</strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>$parent</span></li></ul> <p>鉴于层级过深问题, 本人过懒问题, 以及<code>Vue</code>源码重写数组的问题, 那我们就仿照一下, 直接在<code>Vue</code>原型上做点手脚, 在实例上添加一点自己的东西来解决这个问题. 我们期望是自动向上寻找触发源, 直到顶层, <strong>注意：此方式是向上寻找触发源</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$parent</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">E</span><span class="token punctuation">,</span><span class="token constant">V</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">{</span>
        parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">,</span><span class="token constant">V</span><span class="token punctuation">)</span>
        parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方法还是比较明显的<code>parent</code>只需要存储每次找到的有<code>emit</code>的值, 循环覆盖, 直到不存在<code>parent</code>的顶层. 用法也是极其简单, 因为是直接在原型上扩展, 挂载到<code>vm</code>实例上, 所有需要<strong>注意重名问题</strong>, 使用也是调用即可. 由于是自己实现递归操作, 所以不再需要考虑层级问题.</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">//ChildSon /ChildN</span>
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">addPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$parent</span><span class="token punctuation">(</span><span class="token string">'changePrice'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><strong>多层嵌套传参升级</strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>$children</span></li></ul> <p>目前为止, 我们已经解决了无限嵌套向上寻找触发源的问题, 那么恶心的需求总是有一次以及无数次, 下面我们又有个需求, 我需要在顶层组件触发旗下所有子组件的某个方法, 听起来有点像发布订阅的概念, 及似广播事件, 不过这个实现思路, 倒也是很<code>$parent</code>差不多, 好像就是方向不同罢了. 那么再来试试. 既然用法相同无异, 那实现定时无异.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$broadscat</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">E</span><span class="token punctuation">,</span><span class="token constant">V</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$children
    <span class="token keyword">function</span> <span class="token function">boad</span><span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            child<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">,</span><span class="token constant">V</span><span class="token punctuation">)</span>
             <span class="token comment">// 迭代递归</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>$children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">broad</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>$children<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">boad</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>也不是很难吧, 就是简单的循环查找, 存在下级就接着找, 触发一切你想要触发的事件, 用法与上无异.</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">//App</span>
    methods<span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token function">addPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$broadscat</span><span class="token punctuation">(</span><span class="token string">'changePrice'</span><span class="token punctuation">,</span><span class="token number">6666</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><strong>多层多参数嵌套传参</strong><span class="badge warn" style="vertical-align:top;" data-v-26ebd6a3>$attrs $listeners</span></li></ul> <p>既然恶心那就恶心到底, 在来一个需求, 同时传入多个<strong>参数/方法</strong>并且, <strong>多层传递</strong>, 场景如下, 第二层组件不使用方法, 第三层才需要使用.</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// Parent
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">:price</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>price<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:count</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eat<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@mouseup</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Child</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

// Child
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildSon</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ChildSon</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

// ChildSon
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    {{props}}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>那这不是很简单, <code>Props</code>接受一下不就完事了, 没错我也是这么想的, 我在第二层Props拦截接受了一下, 如果在当前页面使用过就发现传递不下去了, 抛开这一点, 就算逐个接受, 也有诸多不便, 难道写一大堆接受方法？ 然后翻遍<code>Api</code>发现还有<code>$Attrs</code>,<code>$listeners</code>这两东西.</p> <ul><li><strong>多层多参数嵌套升级传参</strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>$attrs</span></li></ul> <p>先来试试同时接受多个属性, 并且传递到下一层</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// Child
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildSon</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ChildSon</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
// ChildSon
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    {{$attrs}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>完美, 这里需要注意到的是, <code>$attrs</code>可以是复合属性, 并且在当前页面直接<code>$attrs.xxx</code>都是完全OK, 但是必须得使用<code>v-bind</code>来动态绑定, 并且不能简写成<code>:</code></p> <ul><li><strong>多层多参数嵌套升级传参</strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>$listeners</span></li></ul> <p>属性都这样写出来了, 方法必然也是雷同.</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// Child
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildSon</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$listeners<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ChildSon</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
// ChildSon
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    {{$attrs}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$listeners.click<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@mouseup</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$listeners.mouseup<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>没毛病.</p> <ul><li><strong>多层多参数嵌套升级传参</strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>provider inject</span></li></ul> <p>看了下官方推荐, 不建议使用, 原因是状态混乱, 看到<code>provider</code>就让我想到了<code>React</code>中的<code>context</code>, 一看就是全局包装暴露父组件本身实例, 那就不做过多阐述, 人家都不推荐使用, 想要了解方法的可以直接前往官网查看.</p> <ul><li><strong>实例获取方法</strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>ref</span></li></ul> <p>这个就强了, 直接获取到真实<code>DOM</code>的实例来操作, 由于<code>Vue</code>是一个实例, 再也不用担心, 会想<code>React</code>一样碰到函数式写法,拿不到<code>this</code>实例, 这个可以直接操作实例上的方法, 可以说是最简单粗暴的.看用法</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>son2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Child</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 直接通过parent上的ref来获取</span>
    <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>简单粗暴, 只需要注意获取真实<code>DOM</code>千万不要重名, 不然就会出现覆盖或者找不到实例的情况.</p> <ul><li><strong>第三者方法</strong><span class="badge tip" style="vertical-align:top;" data-v-26ebd6a3>eventBus</span></li></ul> <p>听说这个是用的最为常见的, 用法也是<code>$emit</code>,<code>$on</code>的用法, 和<code>$parent</code>,<code>$children</code>有些许差异, 这个更像是将转接权交给第三者来转发, 之后就可以在任何组件定义事件源, 在任何组件触发任何事件源, 用起来感觉很舒服, 先根据需求来试试怎么写.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>很简单有不有, 只需要暴露一个实例即可, 那他的实例上不就有<code>$emit</code>触发源以及<code>$on</code>绑定源, 不就可以做到任意化,</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// Parent</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// eventsBus</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">&quot;bus&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bus'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">// anyComponent</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'bus'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>由于<code>mounted</code>的钩子执行顺序的原因, 这里使用<code>$nextTick</code>来延迟执行, 等到视图全图挂载完成在执行该方法，看起来似乎并没有什么毛病, 但个人感觉这样会造成很多不必要的更细操作以及数据混乱, 一旦操作复杂就会出现状态丢失问题.</p> <ul><li>以上各种使用方法, 个人还是最推荐<code>props $emit</code>, 感觉这两个最不会出现问题, 最简单的也是最稳妥的.</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">12/4/2019, 12:43:57 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/FAQ/Vue/observer.html" class="prev">
        🔧乞丐版本MvvM
      </a></span> <span class="next"><a href="/FAQ/Work/TSC.html">
        🏋️‍♂️TypeScript
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.903983bb.js" defer></script><script src="/assets/js/2.c5c844f9.js" defer></script><script src="/assets/js/21.436a904b.js" defer></script><script src="/assets/js/10.acc61093.js" defer></script>
  </body>
</html>
